records = [[[150, 290, 294, 640, 773], 0.6],
           [[401, 635, 689, 742, 939], 0.25],
           [[103, 303, 675, 711, 930], 0.25],
           [[55, 58, 498, 727, 856], 0.3],
           [[225, 431, 753, 851, 912], 0.25],
           [[198, 430, 482, 727, 941], 0.4],
           [[83, 394, 400, 474, 742], 0.25],
           [[218, 272, 385, 676, 849], 0.25],
           [[11, 38, 63, 95, 851], 0.3],
           [[186, 242, 724, 742, 831], 0.25],
           [[344, 346, 701, 742, 925], 0.4],
           [[74, 96, 301, 322, 856], 0.25],
           [[16, 137, 220, 246, 708], 0.4],
           [[316, 353, 409, 672, 965], 0.65],
           [[74, 88, 465, 677, 970], 0.25],
           [[537, 542, 801, 846, 909], 0.25],
           [[478, 718, 745, 757, 884], 0.35],
           [[329, 388, 672, 829, 963], 0.4],
           [[135, 278, 404, 501, 742], 0.25],
           [[274, 380, 549, 652, 952], 0.25],
           [[30, 409, 624, 742, 921], 0.25],
           [[280, 377, 403, 409, 865], 0.25],
           [[334, 348, 520, 724, 761], 0.3],
           [[159, 325, 706, 785, 856], 0.45],
           [[42, 258, 285, 633, 718], 0.3],
           [[77, 107, 291, 571, 900], 0.5],
           [[87, 151, 591, 768, 902], 0.3],
           [[173, 290, 555, 649, 745], 0.25],
           [[218, 304, 607, 638, 801], 0.25],
           [[132, 346, 470, 761, 863], 0.3],
           [[28, 229, 439, 568, 646, 830], 0.3],
           [[343, 452, 468, 742, 779, 802], 0.35],
           [[189, 495, 675, 814, 912, 958], 0.25],
           [[104, 154, 470, 679, 756, 862], 0.25],
           [[139, 334, 394, 419, 568, 598], 0.25],
           [[143, 148, 412, 708, 742, 829], 0.4],
           [[164, 348, 375, 648, 652, 658], 0.3],
           [[246, 697, 710, 837, 939, 963], 0.25],
           [[8, 54, 437, 684, 691, 856], 0.35],
           [[54, 198, 308, 689, 742, 802], 0.35],
           [[42, 564, 636, 752, 805, 935], 0.25],
           [[254, 258, 356, 468, 870, 947], 0.25],
           [[293, 294, 560, 640, 710, 785], 0.25],
           [[69, 137, 391, 625, 870, 894], 0.25],
           [[8, 569, 600, 722, 761, 877], 0.25],
           [[82, 569, 679, 768, 912, 937], 0.3],
           [[88, 280, 501, 851, 865, 935], 0.35],
           [[19, 219, 418, 491, 705, 801], 0.3],
           [[101, 167, 192, 635, 772, 888], 0.3],
           [[279, 325, 505, 608, 736, 813], 0.4],
           [[66, 467, 594, 741, 772, 792], 0.3],
           [[220, 479, 482, 617, 922, 962], 0.25],
           [[134, 226, 477, 572, 642, 777], 0.3],
           [[243, 283, 291, 378, 541, 931], 0.25],
           [[81, 307, 308, 768, 829, 889], 0.3],
           [[613, 643, 653, 703, 741, 829], 0.35],
           [[99, 240, 408, 419, 689, 851], 0.25],
           [[123, 664, 742, 785, 801, 824], 0.35],
           [[134, 265, 349, 642, 655, 813], 0.25],
           [[229, 589, 745, 780, 817, 884], 0.3],
           [[218, 236, 283, 481, 656, 894, 963], 0.35],
           [[119, 275, 350, 423, 547, 733, 865], 0.25],
           [[22, 101, 216, 404, 641, 768, 824], 0.3],
           [[188, 218, 420, 553, 711, 779, 908], 0.35],
           [[211, 217, 246, 344, 412, 591, 718], 0.25],
           [[98, 321, 344, 436, 772, 933, 953], 0.35],
           [[37, 79, 387, 473, 534, 729, 936], 0.35],
           [[312, 468, 679, 765, 830, 892, 939], 0.25],
           [[44, 155, 377, 387, 564, 689, 856], 0.35],
           [[36, 38, 276, 335, 679, 801, 837], 0.25],
           [[186, 394, 497, 542, 601, 607, 653], 0.25],
           [[157, 202, 256, 663, 742, 769, 856], 0.25],
           [[316, 391, 398, 510, 640, 811, 958], 0.35],
           [[88, 238, 356, 778, 878, 959, 966], 0.25],
           [[4, 81, 90, 566, 712, 786, 889], 0.25],
           [[55, 107, 129, 293, 395, 630, 855], 0.25],
           [[103, 135, 279, 343, 643, 809, 817], 0.25],
           [[272, 635, 742, 766, 843, 924, 959], 0.25],
           [[106, 252, 420, 488, 527, 679, 819], 0.6],
           [[107, 123, 272, 439, 788, 894, 963], 0.3],
           [[252, 463, 605, 622, 669, 679, 729], 0.3],
           [[263, 332, 533, 636, 817, 947, 963], 0.5],
           [[88, 255, 349, 569, 647, 746, 768], 0.35],
           [[86, 138, 468, 732, 801, 861, 944], 0.3],
           [[63, 117, 151, 502, 531, 558, 635], 0.3],
           [[9, 11, 343, 468, 474, 708, 742], 0.25],
           [[117, 176, 426, 550, 636, 658, 728], 0.25],
           [[162, 215, 271, 284, 308, 590, 856], 0.3],
           [[46, 77, 211, 222, 361, 518, 679], 0.25],
           [[280, 291, 309, 466, 534, 597, 605], 0.25],
           [[439, 487, 496, 541, 754, 858, 920, 951], 0.3],
           [[32, 151, 158, 163, 171, 302, 775, 830], 0.3],
           [[215, 355, 364, 567, 572, 576, 744, 931], 0.35],
           [[77, 87, 117, 245, 605, 607, 805, 856], 0.25],
           [[203, 276, 423, 531, 669, 679, 718, 844], 0.25],
           [[69, 119, 292, 325, 745, 781, 823, 872], 0.55],
           [[483, 666, 696, 742, 767, 822, 856, 928], 0.3],
           [[245, 269, 320, 375, 542, 558, 768, 826], 0.25],
           [[11, 69, 74, 278, 439, 570, 642, 966], 0.25],
           [[33, 277, 360, 447, 568, 679, 689, 959], 0.3],
           [[18, 41, 122, 246, 711, 777, 780, 904], 0.3],
           [[72, 255, 400, 639, 713, 733, 747, 768], 0.3],
           [[236, 284, 482, 489, 549, 697, 701, 956], 0.25],
           [[91, 167, 201, 246, 267, 272, 378, 525], 0.25],
           [[7, 90, 104, 210, 284, 555, 639, 818], 0.3],
           [[142, 219, 231, 349, 378, 732, 801, 816], 0.25],
           [[30, 409, 448, 491, 605, 607, 664, 856], 0.25],
           [[247, 374, 419, 503, 642, 801, 883, 912], 0.3],
           [[98, 217, 290, 481, 510, 605, 693, 754], 0.25],
           [[117, 353, 380, 431, 493, 553, 794, 800], 0.25],
           [[107, 137, 291, 380, 530, 587, 753, 963], 0.3],
           [[140, 236, 352, 588, 680, 741, 926, 961], 0.35],
           [[50, 80, 107, 162, 602, 669, 742, 958], 0.25],
           [[96, 184, 607, 624, 673, 708, 711, 760], 0.25],
           [[90, 150, 234, 248, 468, 633, 741, 898], 0.25],
           [[159, 218, 291, 378, 482, 558, 736, 794], 0.25],
           [[238, 269, 298, 527, 636, 742, 744, 754], 0.25],
           [[11, 215, 340, 551, 569, 595, 677, 951], 0.35],
           [[27, 85, 244, 355, 391, 468, 589, 909], 0.25],
           [[132, 303, 315, 394, 401, 547, 734, 757], 0.3],
           [[6, 176, 187, 244, 287, 497, 653, 691, 856], 0.3],
           [[98, 132, 420, 635, 636, 807, 835, 900, 964], 0.3],
           [[112, 177, 283, 349, 551, 622, 760, 853, 894], 0.35],
           [[166, 203, 300, 563, 614, 679, 856, 858, 933], 0.25],
           [[13, 73, 174, 497, 598, 679, 875, 930, 946], 0.25],
           [[90, 252, 290, 420, 430, 627, 654, 761, 792], 0.4],
           [[119, 277, 302, 331, 564, 597, 676, 732, 934], 0.25],
           [[141, 273, 291, 406, 431, 679, 872, 877, 912], 0.3],
           [[48, 99, 189, 346, 426, 610, 742, 813, 878], 0.25],
           [[76, 162, 248, 252, 353, 400, 505, 679, 756], 0.3],
           [[41, 210, 439, 562, 706, 712, 727, 856, 869], 0.25],
           [[4, 112, 185, 217, 364, 465, 745, 818, 877], 0.25],
           [[90, 103, 240, 243, 334, 496, 713, 780, 966], 0.4],
           [[33, 496, 515, 589, 677, 694, 745, 801, 846], 0.25],
           [[2, 32, 99, 217, 640, 674, 853, 876, 888], 0.25],
           [[202, 236, 348, 386, 476, 498, 564, 777, 856], 0.25],
           [[99, 191, 233, 242, 465, 777, 893, 930, 958], 0.35],
           [[26, 86, 211, 222, 293, 487, 510, 636, 912], 0.25],
           [[61, 215, 325, 394, 567, 588, 600, 614, 742], 0.25],
           [[107, 267, 550, 604, 642, 817, 837, 865, 945], 0.25],
           [[186, 212, 353, 572, 737, 744, 843, 868, 958], 0.3],
           [[137, 176, 189, 236, 362, 586, 658, 720, 876], 0.3],
           [[53, 70, 132, 265, 279, 350, 593, 641, 852], 0.25],
           [[312, 543, 676, 679, 697, 704, 744, 750, 935], 0.25],
           [[11, 32, 56, 278, 356, 405, 419, 641, 757], 0.25],
           [[106, 190, 263, 342, 343, 439, 651, 744, 866], 0.25],
           [[210, 230, 358, 497, 643, 644, 703, 761, 912], 0.35],
           [[4, 60, 73, 300, 429, 500, 679, 934, 956], 0.3],
           [[96, 208, 310, 348, 366, 679, 688, 803, 856], 0.3],
           [[200, 302, 468, 520, 527, 679, 716, 821, 872], 0.3],
           [[138, 211, 236, 395, 553, 772, 779, 837, 893, 959], 0.25],
           [[279, 285, 320, 387, 597, 600, 643, 858, 890, 906], 0.25],
           [[140, 294, 304, 356, 477, 589, 590, 640, 673, 967], 0.25],
           [[314, 353, 386, 388, 417, 481, 615, 677, 801, 813], 0.25],
           [[23, 358, 624, 625, 695, 742, 761, 856, 915, 972], 0.25],
           [[4, 25, 257, 393, 417, 473, 491, 498, 597, 856], 0.35],
           [[173, 201, 220, 346, 452, 465, 488, 619, 721, 866], 0.3],
           [[55, 285, 361, 572, 688, 772, 817, 936, 938, 970], 0.3],
           [[164, 174, 303, 371, 386, 387, 441, 734, 837, 856], 0.25],
           [[208, 292, 317, 467, 602, 607, 719, 814, 869, 930], 0.45],
           [[4, 74, 205, 386, 429, 447, 633, 656, 742, 881], 0.3],
           [[126, 132, 242, 332, 458, 480, 648, 738, 856, 857], 0.4],
           [[75, 220, 297, 378, 400, 435, 486, 656, 713, 934], 0.25],
           [[129, 258, 263, 335, 419, 589, 631, 636, 735, 835], 0.35],
           [[272, 283, 420, 486, 493, 555, 572, 586, 601, 856], 0.25],
           [[192, 231, 244, 295, 344, 355, 356, 631, 733, 822], 0.4],
           [[98, 173, 231, 337, 505, 624, 664, 689, 690, 870], 0.25],
           [[70, 220, 256, 259, 370, 670, 742, 752, 818, 883], 0.25],
           [[174, 262, 485, 542, 558, 605, 649, 679, 742, 756], 0.35],
           [[51, 73, 380, 494, 553, 648, 679, 728, 800, 958], 0.25],
           [[18, 141, 183, 429, 433, 469, 658, 824, 856, 892], 0.3],
           [[380, 386, 590, 614, 615, 701, 753, 768, 843, 852], 0.25],
           [[480, 482, 566, 570, 622, 679, 742, 756, 905, 929], 0.35],
           [[340, 400, 550, 571, 717, 729, 742, 771, 775, 849], 0.35],
           [[101, 291, 309, 394, 522, 534, 605, 773, 816, 924], 0.25],
           [[34, 168, 356, 439, 555, 586, 677, 764, 800, 817], 0.25],
           [[48, 72, 309, 446, 497, 527, 558, 608, 679, 741], 0.25],
           [[6, 141, 208, 218, 258, 430, 511, 707, 763, 809], 0.6],
           [[32, 90, 98, 146, 238, 263, 546, 648, 705, 741], 0.25],
           [[151, 290, 291, 496, 501, 530, 771, 801, 851, 965], 0.4]]

import go
import numpy as np
import preprocessing
import os
import time

tf_examples = []


def touchOneRecord(record, name, v):
    start = np.zeros(go.N).astype(np.float32)

    remain = 10
    for i in range(len(record)):
        pi = np.ones(go.M).astype(np.float32) * 0.1
        pi[record[i]] = 0.9
        pi = pi / pi.sum()
        tf_examples.append(preprocessing.make_tf_example((np.expand_dims(start, axis=2), remain), pi, v))

        start = start + go.d[record[i]]
        remain -= 1

    if len(record) < 10:
        pi = np.ones(go.M).astype(np.float32) * 0.1
        pi[-1] = 0.9
        pi = pi / pi.sum()
        tf_examples.append(preprocessing.make_tf_example((np.expand_dims(start, axis=2), remain), pi, v))


i = 1
for record in records:
    touchOneRecord(record[0], i, record[1])
    i += 1

output_name = '{}-{}'.format(int(time.time()), 1)
fname = os.path.join('madeup', "{}.tfrecord.zz".format(output_name))
preprocessing.write_tf_examples(fname, tf_examples)

ds = preprocessing.get_input_tensors(128, [fname], filter_amount=1)
import tensorflow as tf

with tf.Session() as sess:
    print(sess.run(ds))

